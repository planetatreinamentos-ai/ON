<?php
error_reporting(E_ALL);
ini_set('display_errors', '1');

echo "1. Index.php carregado<br>";

define('ROOT_PATH', dirname(__DIR__));
echo "2. ROOT_PATH: " . ROOT_PATH . "<br>";

// Verifica se existe o autoload do composer
if (file_exists(ROOT_PATH . '/vendor/autoload.php')) {
    require ROOT_PATH . '/vendor/autoload.php';
    echo "3. Composer autoload carregado<br>";
} else {
    echo "3. ERRO: Composer autoload NÃO encontrado em: " . ROOT_PATH . '/vendor/autoload.php<br>';
}

// Autoloader customizado
spl_autoload_register(function ($class) {
    $class = str_replace('PlanetaTreinamentos\\', '', $class);
    $class = str_replace('\\', DIRECTORY_SEPARATOR, $class);
    $file = ROOT_PATH . '/src/' . $class . '.php';
    
    echo "4. Tentando carregar: $file<br>";
    
    if (file_exists($file)) {
        require $file;
        echo "5. Arquivo carregado com sucesso<br>";
    } else {
        echo "5. ERRO: Arquivo não encontrado<br>";
    }
});

echo "6. Tentando iniciar App...<br>";

try {
    $app = new PlanetaTreinamentos\Core\App();
    echo "7. App criado<br>";
    $app->run();
} catch (Throwable $e) {
    echo "<h2>ERRO CAPTURADO:</h2>";
    echo "<pre>";
    echo "Mensagem: " . $e->getMessage() . "\n";
    echo "Arquivo: " . $e->getFile() . "\n";
    echo "Linha: " . $e->getLine() . "\n\n";
    echo "Stack Trace:\n" . $e->getTraceAsString();
    echo "</pre>";
}